<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>2016 İmsakiye</title>
  <meta name="description" content="">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://www.semihturan.xyz/">
  <link rel="alternate" type="application/rss+xml" title="2016 İmsakiye" href="http://www.semihturan.xyz/feed.xml">
</head>

  <body>
    <nav class="navbar navbar-inverse navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <a class="navbar-brand" href="#"><span>2016 İmsakiye</span></a>
    </div>
  </div>
</nav>

    <div class="header-offset"></div>
    <nav>
    <div class="container text-center">
        <div class="btn-group btn-group-justified">
            <div class="btn btn-group">
                <button type="button" class="btn btn-primary dropdown-toggle" id="countryButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Ülke seçiniz<span class="caret"></span></button>
                <ul class="dropdown-menu" id="dropdownSelectCountry"></ul>
            </div>
            <div class="btn btn-group">
                <button type="button" class="btn btn-primary dropdown-toggle" id="cityButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">İl seçiniz<span class="caret"></span></button>
                <ul class="dropdown-menu" id="dropdownSelectCity"></ul>
            </div>
            <div class="btn btn-group">
                <button type="button" class="btn btn-primary dropdown-toggle" id="countyButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">İlçe seçiniz<span class="caret"></span></button>
                <ul class="dropdown-menu" id="dropdownSelectCounty"></ul>
            </div>
        </div>
    </div>
</nav>

    <nav class="hidden">
  <div class="container col-sm-10 col-sm-offset-1">
    <div class="panel panel-primary">
      <div class="panel-heading text-center"></div>
      <table class="table" id="time"></table>
    </div>
  </div>
</nav>

    <nav>
<div class="navbar navbar-default navbar-fixed-bottom">
  <div class="container">
    <h2>2016 İmsakiye</h2>
    <h6>Veriler T.C. Diyanet İşleri Başkanlığı'ndan alınmıştır.</h6>
  </div>
</div>
</nav>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>

    <script type="text/javascript">
    var time = $('#time');
    var place = $('.panel-heading');
    var countryName;
    var countryValue;
    var cityName;
    var cityValue;
    var countyName;
    var countyValue;

    $(document).ready(function() {

        getCountry();

        function getCountry() {
            jQuery.ajax({
                type: 'GET',
                url: 'http://www.semihturan.xyz/namaz-vakitleri/countries.json',
                data: '{ }',
                dataType: 'json',
                success: function(data) {
                    $.each(data.root.country, function(index, element) {
                        $('#dropdownSelectCountry').append('<li><a class="countryItem">' + element.country + '</a></li>');
                        $('.countryItem').click(function() {
                            countryName = $(this).html();
                            $('#countryButton').html(countryName + '<span class="caret"></span>');
                            $(this).addClass('selected');
                        });
                    });
                    $('.countryItem').click(function() {
                        $('#dropdownSelectCity').children().remove();
                        $('#dropdownSelectCounty').children().remove();
                        $('#cityButton').html('İl seçiniz <span class="caret"></span>');
                        $('#countyButton').html('İlçe seçiniz <span class="caret"></span>');
                        setCountry();
                    });

                    function setCountry() {
                        console.log('Ulke adi: ' + countryName);
                        for (var i = 0; i < data.root.country.length; i++) {
                            if (data.root.country[i].country === countryName) {
                                countryValue = data.root.country[i].value.match(/\d+/)[0];
                                console.log('Ulke kodu: ' + countryValue);
                                getCity();
                            }
                        }
                    }
                }
            });
        }

        function getCity() {
            $.ajax({
                url: 'http://ramazan.diyanet.gov.tr/imsakiye/',
                type: "POST",
                data: {
                    "ulkeId": countryValue,
                },
                success: function(dataReturned) {
                    console.log('success ');
                    var html = $.parseHTML(dataReturned);
                    var cities = $(html).find('#ilId').children();
                    $.each(cities, function(index, element) {
                        cityName = cities.eq(index).html();
                        $('#dropdownSelectCity').append('<li><a class="cityItem">' + cityName + '</a></li>');
                        $('.cityItem').click(function() {
                            cityName = $(this).html();
                            $('#cityButton').html(cityName + '<span class="caret"></span>');
                            $(this).addClass('selected');
                        });
                    });
                    $('.cityItem').click(function() {
                        $('#dropdownSelectCounty').children().remove();
                        $('#countyButton').html('İlçe seçiniz <span class="caret"></span>');
                        setCity();
                    });

                    function setCity() {
                        for (var i = 0; i < cities.length; i++) {
                            if (cities.eq(i).html() === cityName) {
                                console.log('Sehir adi: ' + cityName);
                                cityValue = cities.eq(i).attr("value").match(/\d+/)[0];
                                console.log('Sehir kodu: ' + cityValue);
                                getCounty();
                            }
                        }
                    }
                }
            });
        }

        function getCounty() {
            $.ajax({
                url: 'http://www.diyanet.gov.tr/PrayerTime/FillCity?itemId=' + parseInt(cityValue),
                success: function(data) {
                    $.each(data, function(index, element) {
                        $('#dropdownSelectCounty').append('<li><a class="countyItem">' + element.Text + '</a></li>');
                        $('.countyItem').click(function() {
                            countyName = $(this).html();
                            $('#countyButton').html(countyName + '<span class="caret"></span>');
                        });
                    });
                    $('.countyItem').click(function() {
                        setCounty();
                    });

                    function setCounty() {
                        console.log('Ilce adi: ' + countyName);
                        for (var i = 0; i < data.length; i++) {
                            if (data[i].Text === countyName) {
                                countyValue = data[i].Value.match(/\d+/)[0];
                                console.log('Ilce kodu: ' + countyValue);
                                getImsakiye();
                            }
                        }
                    }
                }
            });
        }

        function getImsakiye() {
            $(".hidden").removeClass("hidden");
            jQuery.ajax({
                url: "http://ramazan.diyanet.gov.tr/imsakiye/",
                type: "POST",
                data: {
                    "ulkeId": countryValue,
                    "ilId": cityValue,
                    "ilceId": countyValue
                },
                dataType: "text",
                success: function(data) {
                    time.children().remove();
                    var rows = jQuery(data).find("#table").children().children();
                    var rowInfo;
                    selectedPlace = rows.eq(0).children().eq(0).text().split("İmsakiye");
                    place.text(selectedPlace + cityName);
                    for (i = 2; i < 28; i++) {
                        var columns = rows.eq(i).children();
                        rowInfo += '<td>' + (i - 1) + ' Ramazan 1437</td>';
                        for (x = 1; x < 2; x++) {
                            var rawText = columns.eq(x).text().split(/ +/);
                            console.log(rawText);
                            text = rawText[1] + ' ' + rawText[2] + ' '+ rawText[3];
                            rowInfo += '<td>' + text + '</td>';
                        }
                        for (x = 2; x < columns.length; x++) {
                            var text = columns.eq(x).text();
                            rowInfo += '<td>' + text + '</td>';
                        }
                        time.append('<tr>' + rowInfo + '</tr>');
                        rowInfo = "";
                    }
                    for (i = 28; i < 29; i++) {
                        rowInfo += '<td class= "text-center" colspan=100%> Kadir Gecesi </td>';
                        time.append('<tr>' + rowInfo + '</tr>');
                        rowInfo = "";
                    }
                    for (i = 29; i < 32; i++) {
                        var columns = rows.eq(i).children();
                        rowInfo += '<td>' + (i - 2) + ' Ramazan 1437</td>';
                        for (x = 1; x < 2; x++) {
                            var rawText = columns.eq(x).text().split(/ +/);
                            console.log(rawText);
                            text = rawText[1] + ' ' + rawText[2] + ' '+ rawText[3];
                            rowInfo += '<td>' + text + '</td>';
                        }
                        for (x = 2; x < columns.length; x++) {
                            var text = columns.eq(x).text();
                            rowInfo += '<td>' + text + '</td>';
                        }
                        time.append('<tr>' + rowInfo + '</tr>');
                        rowInfo = "";
                    }
                    for (i = 33; i < 34; i++) {
                        var text = rows.eq(i).children().eq(0).html();
                        // time.append('<tr class= "text-center" colspan=100%>' + text+ '</tr>');
                        // rowInfo = "";
                    }
                }
            });
        }
    });
</script>

  </body>
</html>
